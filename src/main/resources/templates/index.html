<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://i.postimg.cc/YqTT15xb/image.png">
    <title>&nd, admin</title>
    <!--  <link rel="stylesheet" href="/main.css"/>-->
    <style>
        /* Reset some default styles */
        body, h1, h2, p, ul, li {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
        }

        /* Header Styles */
        .logo img {
            margin-top: 10px;
            margin-left: 20px;
            max-width: 150px;
            height: auto;
        }


        #profile-text {
            /* 추가된 스타일 */
            display: inline-block;
            margin-left: 40px;
            color: #000;
            font-weight: bold;
        }

        #profile-text:hover {
            /* 추가된 스타일 */
            display: inline-block;
            margin-left: 40px;
            color: #fff;
            font-weight: bold;
        }

        /* Container Styles */
        .container {
            display: flex;
            margin: 20px;
        }

        main {
            flex: 3;
            padding: 20px;
            background-color: #fff;
        }

        /* Banner Styles */
        .banner img {
            width: 100%;
            height: auto;
            margin-bottom: 20px;
        }

        .search-bar {
            display: flex;
            align-items: center;
        }

        .search-bar input[type="text"] {
            padding: 10px;
            border: 2px solid lightgray;
            border-radius: 20px;
            width: 500px; /* Adjust the width as needed */
        }

        .search-icon {
            margin-left: -40px;
            padding: 8px;
            background-color: white;
            border-radius: 50%;
            cursor: pointer;
            width: 17px;
            height: 17px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .search-icon img {
            max-width: 90%;
            max-height: 90%;
        }

        /* Contest List Styles */
        .section {
            /* 추가된 스타일 */
            flex: 1;
            padding: 5px;
        }

        .sections-container {
            margin-left: 200px;
            height: 750px;
            display: flex;
            gap: 30px;
            background-color: #fff;
        }

        .section_in {
            height: 700px;
        }

        .section-heading {
            margin-top: 1px;
            text-align: center;
        }


        /* Responsive Styles */
        @media screen and (max-width: 768px) {
            .container {
                flex-direction: column;
            }
        }

        ul {
            list-style-type: none;
            padding: 0px;
            margin: 0px;
            width: 200px;
            background: linen;
            height: 100%;
            overflow: auto;
            position: fixed;
        }

        li a {
            margin-top: 20px;
            text-decoration: none;
            padding: 10px;
            display: block;
            color: #000;
            text-align: center;
            font-weight: bold;
        }

        li a:hover {
            background: lightsalmon;
            color: #fff;
        }

        .cd1 {
            margin-left: 20px;
            height: 100px;
            background-color: linen;
        }

        .auth-buttons {
            width: 149px;
            height: 25px;
            margin-left: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background-color: lightsalmon;
            color: white;
            cursor: pointer;
        }

        .delete-button {
            position: fixed; /* 요소를 화면에 고정 */
            bottom: 50px; /* 아래 여백 조절 */
            right: 50px; /* 오른쪽 여백 조절 */
            z-index: 1; /* 다른 요소 위에 위치하도록 설정 */
            background-color: lightsalmon;
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .delete-button:hover {
            color: white;
        }

        /* 자유게시판 CSS */
        /*.post-wrap {*/
        /*  margin: 20px;*/
        /*  padding: 20px;*/
        /*}*/

        /*.post-title {*/
        /*  margin-bottom: 20px;*/
        /*}*/

        /*.post-title strong {*/
        /*  font-size: 1.3rem;*/
        /*}*/

        .post-title p {
            margin-top: 5px;
            font-size: 0.8rem;
        }

        .post-list {
            width: 100%;
            border-top: 2px solid #000;
        }

        .post-list > div {
            border-bottom: 1px;
            font-size: 0;
        }

        .post-list > div.top {
            border-bottom: 1px solid #999;
        }

        .post-list > div:last-child {
            border-bottom: 1px solid #000;
        }

        .post-list > div > div {
            display: inline-block;
            padding: 15px 0;
            text-align: center;
            font-size: 0.9rem;
        }

        .post-list > div.top > div {
            font-weight: bold;
        }

        .post-list .num {
            width: 10%;
        }

        .post-list .title {
            width: 50%;
            text-align: left;
        }

        .post-list .top .title {
            text-align: center;
        }

        .post-list .writer {
            width: 10%;
        }

        .post-list .date {
            width: 20%;
        }

        .post-list .count {
            width: 10%;
        }

        .post-page {
            margin-top: 20px;
            text-align: center;
            font-size: 0;
        }

        .post-page a {
            display: inline-block;
            width: 32px;
            height: 32px;
            box-sizing: border-box;
            vertical-align: middle;
            border: 1px solid #ddd;
            border-radius: 7px;
            border-left: 0;
            line-height: 100%;
        }

        .post-page a.bt {
            padding-top: 10px;
            font-size: 1.0rem;
            letter-spacing: -1px;
        }

        .post-page a.num {
            padding-top: 9px;
            font-size: 0.9rem;
        }

        .post-page a.num.on {
            border-color: #000;
            background: #000;
            color: #fff;
        }

        .post-page a:first-child {
            border-left: 1px solid #ddd;
        }

        /* Category Management Container Styles */
        .category.container {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 1100px;

        }

        .category.container h2.section-heading {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Center the content within the container */
        .section_in {
            text-align: center;
            width: 100%;
        }

        /* Category Management Container Styles */
        .category.container {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 800px;
        }

        .category.container h2.section-heading {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        .create-category, .read-categories {
            margin-bottom: 20px;
        }

        .create-category h3, .read-categories h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #444;
        }

        #createCategoryForm input[type="text"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }

        #createCategoryForm button {
            padding: 10px 20px;
            background-color: lightsalmon;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #createCategoryForm button:hover {
            background-color: lightsalmon;
        }

        #categoryTable {
            width: 100%;
            border-collapse: collapse;
        }

        #categoryTable th {
            background-color: lightsalmon;
            color: #fff;
            padding: 10px;
            text-align: left;
        }

        #categoryTable td {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }

        #categoryTable td:last-child {
            text-align: center;
        }

        /* Update and Delete buttons */
        #categoryTable button {
            padding: 6px 12px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }

        #categoryTable button:hover {
            background-color: #218838;
        }


    </style>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>

    <script>
        // 자유게시판 페이징 출력
        const pageSize = 10;
        const pageBtnSize = 5;

        function showPosts(page, size) {
            if (page <= 0) {
                page = 1;
            }

            $.ajax({
                type: 'GET',
                url: `/api/admin/posts?page=${page}&size=${size}`
            })
                .done(function (response, status, xhr) {
                    let pages = response['totalPages'];
                    console.log(pageSize);
                    if (page > pages) {
                        page = pages;
                    }

                    let html = `

                          <div class="post-list">
                            <div class="top">
                              <div class="num">번호</div>
                              <div class="title">제목</div>
                              <div class="writer">작성자</div>
                              <div class="date">작성일</div>
                              <div class="count">조회수</div>
                            </div>`;

                    let startNum = (page - 1) * pageSize;
                    response['content'].forEach((post) => {
                        startNum += 1;
                        html += `
                        <div>
                          <div class="num">${startNum}</div>
                          <div class="title"><a href="#">${post.title}</a></div>
                          <div class="writer">${post.writer}</div>
                          <div class="date">${post.modifiedDate}</div>
                          <div class="count">${post.communityPostViews}</div>
                        </div>
                    `;
                    });

                    html += `
                    </div>
                     <div class="post-page">
                        <a onclick="showPosts(1,pageSize)" class="bt first"><<</a>
                        <a onclick="showPosts(${page}-1,pageSize)" class="bt prev"><</a>
                `;

                    let startPage = (Math.floor(page / pageBtnSize) * pageBtnSize) + 1;
                    let endPage = (startPage + pageBtnSize) <= pages ? (startPage + pageBtnSize) : pages;

                    for (let i = startPage; i <= endPage; i++) {
                        if (page === i) {
                            html += `
                            <a onclick="showPosts(${i},pageSize)" class="num on">${i}</a>
                        `;
                        } else {
                            html += `
                            <a onclick="showPosts(${i},pageSize)" class="num">${i}</a>
                        `;
                        }
                    }

                    html += `
                            <a onclick="showPosts(${page}+1,pageSize)" class="bt first">></a>
                            <a onclick="showPosts(${pages},pageSize)" class="bt prev">>></a>
                          </div>
                      </div>
                    </div>
                `;
                    $(".list").empty();
                    $(".list").append(html);
                })
                .fail(function (response) {
                    alert("자유게시글 조회 실패");
                    console.log(response.responseJSON.msg);
                });
        }

        // Function to create a new category
        function createCategory() {
            const categoryName = document.getElementById('categoryName').value;

            // Prepare the data to send in the request body
            const categoryData = {
                categoryName: categoryName,
            };

            // Perform AJAX POST request to create a new category on the server
            $.ajax({
                type: 'POST',
                url: '/api/admin/category',
                contentType: 'application/json',
                data: JSON.stringify(categoryData),
                success: function (response) {
                    // Update the table with the newly created category
                    readCategories();
                    alert(response.message); // Display a success message
                },
                error: function (xhr) {
                    alert('카테고리생성실패: ' + xhr.statusText);
                },
            });
        }

        // Function to read categories and populate the table
        function readCategories() {
            // Perform AJAX GET request to retrieve all categories from the server
            $.ajax({
                type: 'GET',
                url: '/api/admin/category',
                success: function (response) {
                    const categoryTable = document.getElementById('categoryTable');
                    const tbody = categoryTable.getElementsByTagName('tbody')[0];
                    tbody.innerHTML = ''; // Clear existing table rows

                    response.categoryList.forEach(function (category) {
                        const newRow = tbody.insertRow();
                        newRow.id = `categoryRow_${category.id}`; // Assign a unique id
                        newRow.innerHTML = `
        <td>${category.id}</td>
        <td>${category.categoryName}</td>
        <td>
            <button onclick="updateCategory(${category.id})">Update</button>
            <button onclick="deleteCategory(${category.id})">Delete</button>
        </td>
    `;
                    });
                },
                error: function (error) {
                    console.error('카테고리 조회 실패:', error);
                }
            });
        }

        // Call readCategories() to populate the table when the page loads
        readCategories();

        // Function to update a category
        function updateCategory(categoryId) {
            const updatedName = prompt('변경하고자 하는 카테고리 이름을 적어주세요:');
            if (updatedName) {
                // Prepare the data to send in the request body
                const categoryData = {
                    categoryName: updatedName,
                };

                // Perform AJAX PUT request to update the category on the server
                $.ajax({
                    type: 'PUT',
                    url: `/api/admin/category/${categoryId}`,
                    contentType: 'application/json',
                    data: JSON.stringify(categoryData),
                    success: function () {
                        // Update the table with the updated category
                        readCategories();
                        alert('카테고리수정완료');
                    },
                    error: function (xhr) {
                        alert('카테고리수정실패: ' + xhr.statusText);
                    },
                });
            }
        }

        // Function to delete a category
        function deleteCategory(categoryId) {
            // Confirm deletion with the user
            const confirmDelete = confirm('카테고리를 삭제하시겠습니까?');
            if (confirmDelete) {
                // Perform AJAX DELETE request to delete the category on the server
                $.ajax({
                    type: 'DELETE',
                    url: `/api/admin/category/${categoryId}`,
                    success: function () {
                        // Remove the category row from the table
                        const row = document.getElementById(`categoryRow_${categoryId}`);
                        if (row) {
                            row.remove();
                        }
                        alert('카테고리 삭제완료.');
                    },
                    error: function (xhr) {
                        alert('카테고리 삭제실패: ' + xhr.statusText);
                    },
                });
            }
        }
        // Call readCategories function to initially populate the table
        readCategories();

        function logout() {
            let authCookie = getCookie('Authorization');
            console.log(authCookie);
            $.ajax({
                url: 'http://localhost:8080/api/users/logout',
                type: 'POST',
                headers: {
                    'Authorization': authCookie
                },
                processData: false,
                contentType: false,
                success: function (response) {

                    Cookies.remove('Authorization', {path: '/'}); // 쿠키삭제
                    // Cookies.set('Authorization', token, {path: '/', expires: expirationDate});
                    // 요청 성공 시 처리할
                    alert("로그아웃 성공 !");
                    window.location.href = host + '/api/view/user/login';
                },
                error: function (xhr, status, error) {
                    console.log(xhr);
                    alert("로그아웃 실패 !");
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const postMenu = document.querySelector('#post');
            const homeMenu = document.querySelector('#home');
            const reportMenu = document.querySelector('#report-post');
            const contestMenu = document.querySelector('#contest');
            const categoryMenu = document.querySelector('#category');
            const userMenu = document.querySelector('#user');
            const etcMenu = document.querySelector('#etc');

            const homeContainer = document.querySelector('.home.container');
            const postContainer = document.querySelector('.post.container');
            const reportContainer = document.querySelector('.report.container');
            const contestContainer = document.querySelector('.contest.container');
            const categoryContainer = document.querySelector('.category.container');
            const userContainer = document.querySelector('.user.container');
            const etcContainer = document.querySelector('.etc.container');

            postMenu.addEventListener('click', function () {
                homeContainer.style.display = 'none';
                postContainer.style.display = 'block';
                reportContainer.style.display = 'none';
                contestContainer.style.display = 'none';
                categoryContainer.style.display = 'none';
                userContainer.style.display = 'none';
                etcContainer.style.display = 'none';
            });

            homeMenu.addEventListener('click', function () {
                homeContainer.style.display = 'block';
                postContainer.style.display = 'none';
                reportContainer.style.display = 'none';
                contestContainer.style.display = 'none';
                categoryContainer.style.display = 'none';
                userContainer.style.display = 'none';
                etcContainer.style.display = 'none';
            });

            reportMenu.addEventListener('click', function () {
                homeContainer.style.display = 'none';
                postContainer.style.display = 'none';
                reportContainer.style.display = 'block';
                contestContainer.style.display = 'none';
                categoryContainer.style.display = 'none'; // 다른 컨테이너 숨기기
                userContainer.style.display = 'none';
                etcContainer.style.display = 'none';
            });

            contestMenu.addEventListener('click', function () {
                homeContainer.style.display = 'none';
                postContainer.style.display = 'none';
                reportContainer.style.display = 'none';
                contestContainer.style.display = 'block';
                categoryContainer.style.display = 'none'; // 다른 컨테이너 숨기기
                userContainer.style.display = 'none';
                etcContainer.style.display = 'none';
            });

            categoryMenu.addEventListener('click', function () {
                homeContainer.style.display = 'none';
                postContainer.style.display = 'none';
                reportContainer.style.display = 'none';
                contestContainer.style.display = 'none';
                categoryContainer.style.display = 'block';
                userContainer.style.display = 'none';
                etcContainer.style.display = 'none';
            });

            userMenu.addEventListener('click', function () {
                homeContainer.style.display = 'none';
                postContainer.style.display = 'none';
                reportContainer.style.display = 'none';
                contestContainer.style.display = 'none';
                categoryContainer.style.display = 'none';
                userContainer.style.display = 'block';
                etcContainer.style.display = 'none';
            });

            etcMenu.addEventListener('click', function () {
                homeContainer.style.display = 'none';
                postContainer.style.display = 'none';
                reportContainer.style.display = 'none';
                contestContainer.style.display = 'none';
                categoryContainer.style.display = 'none';
                userContainer.style.display = 'none';
                etcContainer.style.display = 'block';
            });
        });

        // 삭제 버튼을 클릭했을 때 실행될 함수
        function deletePost() {
            // 이 부분에 게시물 삭제 로직을 추가하세요.
            // 예를 들어, 선택된 게시물을 삭제하는 AJAX 요청 등을 수행할 수 있습니다.
            // 필요한 경우 서버와 통신하여 삭제 작업을 수행하세요.

            // 여기에 실제 삭제 로직을 추가하세요.
            alert("게시물이 삭제되었습니다."); // 임시로 경고창을 띄움
        }
    </script>
</head>
<body>
<header>
    <div class="logo">
        <ul>
            <img src="https://i.postimg.cc/T3KxY0gd/2.png" alt="Logo">
            <li><a id="home" href="#">홈</a></li>
            <li><a id="post" href="#" onclick="showPosts(1,pageSize)">최근 게시글</a></li>
            <li><a id="report-post" href="#">신고된 게시글/댓글 관리</a></li>
            <li><a id="contest" href="#">공지 및 공모전 관리</a></li>
            <li><a id="category" href="#">카테고리 관리</a></li>
            <li><a id="user" href="#">유저 관리</a></li>
            <li><a id="etc" href="#">기타 이용약관</a></li>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <div class="auth-buttons">
                <span id="profile-text" href="javascript:logout()">로그아웃</span></div>
        </ul>
    </div>
    <div class="cd1">
    </div>
</header>

<div class="home container" style="display: block;">
    <main class="sections-container">
        <div class="section">
            <h2 class="section-heading"><&ND> 최근 방문자 수</h2>
            <div class="section_in">
                <h1>이게된다??</h1>
            </div>
        </div>
        <div class="section">
            <h2 class="section-heading">최근 신고된 게시글 추이</h2>
            <div class="section_in">
                <h1>이게된다??</h1>
            </div>
        </div>
    </main>
</div>

<div class="post container" style="display: none;">
    <main class="sections-container">
        <div class="section">
            <h2 class="section-heading">최근 게시글 전체 조회</h2>
            <div class="section_in">
                <div class="search-bar">
                    <input type="text" placeholder="게시물 검색"><br><br><br><br>
                    <div class="search-icon">
                        <img src="https://i.postimg.cc/MT8tf3Qy/searchmagnifierinterfacesymbol-79894.png"
                             alt="Search Icon">
                    </div>
                </div>
                <div class="list">
                    <!--          불러 온 게시물 노출영역-->
                </div>
                <div class="delete-button">
                    <a onclick="deletePost()">삭제</a>
                </div>
            </div>
        </div>
    </main>
</div>

<div class="report container" style="display: none;">
    <main class="sections-container">
        <div class="section">
            <h2 class="section-heading">2</h2>
            <div class="section_in">
                <h1>야호!!</h1>
            </div>
        </div>
        <div class="section">
            <h2 class="section-heading">2</h2>
            <div class="section_in">
                <h1>야호!!</h1>
            </div>
        </div>
    </main>
</div>

<div class="contest container" style="display: none;">
    <main class="sections-container">
        <div class="section">
            <h2 class="section-heading">3</h2>
            <div class="section_in">
                <h1>야호~~~~~~~~~~!!</h1>
            </div>
        </div>
        <div class="section">
            <h2 class="section-heading">3</h2>
            <div class="section_in">
                <h1>야호~~~~~~~~~~!!!!</h1>
            </div>
        </div>
    </main>
</div>

<div class="category container" style="display: none;">

        <div class="category contents">
            <h2 class="section-heading">카테고리 관리페이지</h2>

                <div class="create-category">
                    <h3>카테고리 생성하기</h3>
                    <form id="createCategoryForm">
                        <input type="text" id="categoryName" placeholder="Category Name">
                        <button type="button" onclick="createCategory()">Create</button>
                    </form>
                </div>

                <!-- Read Categories Table -->
                <div class="read-categories">
                    <h3>카테고리 목록</h3>
                    <table id="categoryTable">
                        <!-- Table headers here -->
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>카테고리이름</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Category rows will be populated here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

</div>



<div class="user container" style="display: none;">
    <main class="sections-container">
        <div class="section">
            <h2 class="section-heading">5</h2>
            <div class="section_in">
                <h1>유저 crud</h1>
            </div>
        </div>
        <div class="section">
            <h2 class="section-heading">5</h2>
            <div class="section_in">
                <h1>유저 crud</h1>
            </div>
        </div>
    </main>
</div>

</body>
</html>